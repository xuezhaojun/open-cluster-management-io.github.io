<!DOCTYPE html>
<html lang="zh"><head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"/>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"/>
  <link rel="stylesheet" href="/main.css"/>
  <link rel="shortcut icon" type="image/svg" href="/ocm.svg">
  <title>Open Cluster Management</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1PXKZXT157"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1PXKZXT157');
  </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">



    


<input id="current-lang" type="hidden" value="zh">

<header class="navbar navbar-expand-lg navbar-dark bd-navbar">
  <nav class="navbar navbar-expand-lg navbar-dark py-3 fixed-top">
    <div class="container-fluid flex-wrap flex-lg-nowrap">
      <a href="/zh/" class="navbar-brand">
        <img src="/ocm.svg" alt="" width="30" height="24" class="align-text-top">
        <span>Open Cluster Management</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item pe-2">
            <a href="/zh/community" class="nav-link text-light">社区</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/contribute" class="nav-link text-light">贡献</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/concepts" class="nav-link text-light">文档</a>
          </li>
          <li class="nav-item pe-2">
            <a href="/zh/blog" class="nav-link text-light">博客</a>
          </li>
          <li class="nav-item dropdown pe-2">
            
            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">中文</a>
            

            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              
              <li><a class="dropdown-item" href="#" id="to-en">English</a></li>
              
            </ul>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank" aria-label="youtube">
                <i class="bi bi-youtube"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://github.com/open-cluster-management-io" target="_blank" aria-label="github">
              <i class="bi bi-github"></i>
            </a>
          </li>
          <li class="nav-item pe-2">
            <a class="nav-link text-light" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank" aria-label="slack">
              <i class="bi bi-slack"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
</div>
        <div class="row subject-padding">
            <div class="col-lg-2 col-md-3 padding-none sidebar-bgc">



    


<div class="sidebar-toggle sidebar-toggle-sm">
    <button type="button" id="sidebarToggle" class="btn btn-info">
        <i class="bi bi-list"></i>
    </button>
</div>
<nav id="sidebar" class="sidebar-hide-sm">
    <ul class="components">
        <li id="concepts">
            <a class="navlink" href="/zh/concepts">概念</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/concepts/architecture">架构</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/clusterclaim">集群声明</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedcluster">托管集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/managedclusterset">托管集群分组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/placement">匹配路由</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestwork">资源下发</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/manifestworkreplicaset">资源下发组</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/addon">自定义插件</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/policy">Policy</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/concepts/multicluster-controlplane">多集群控制面</a>
                </li>
            </ul>
        </li>
        <li id="getting-started">
            <a class="navlink" href="/zh/getting-started">安装</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/getting-started/quick-start">快速开始</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/installation">部署</a>
                    <ul class="collapse">
                        <li>
                            <a class="navlink" href="/zh/getting-started/installation/start-the-control-plane">启动控制面</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/installation/register-a-cluster">注册一个集群</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/integration">插件和集成</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/app-lifecycle">应用生命周期管理</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/cluster-proxy">多集群网络隧道</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-framework">Policy框架</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/policy-controllers">Policy控制器</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/integration/managed-serviceaccount">托管多集群ServiceAccount</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a class="navlink" href="/zh/getting-started/administration">运维管理</a>
                    <ul class="collapse ">
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/upgrading">升级版本</a>
                        </li>
                        <li>
                            <a class="navlink" href="/zh/getting-started/administration/monitoring">监控</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
        <li id="developer-guides">
            <a class="navlink" href="/zh/developer-guides">开发指南</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/developer-guides/addon">Add-on 开发指南</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/developer-guides/vscode-extension">VScode插件</a>
                </li>
            </ul>
        </li>
        <li id="scenarios">
            <a class="navlink" href="/zh/scenarios">应用场景</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/scenarios/deploy-kubernetes-resources">部署Kubernetes资源</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/distribute-workload-with-placement">通过placement分发工作负载</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/migrate-workload-with-placement">通过placement迁移工作负载</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extend-multicluster-scheduling-capabilities">扩展多集群调度能力</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/extending-managed-clusters">扩展集群模型</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/integration-with-argocd">集成Argo CD</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/manage-cluster-with-multiple-hubs">使用多个hub管理同一集群</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/pushing-kube-api-requests">向托管集群推送Kube API请求</a>
                </li>
                <li>
                    <a class="navlink" href="/zh/scenarios/register-cluster-through-proxy">通过代理服务器注册集群</a>
                </li>
            </ul>
        </li>
        <li id="community">
            <a class="navlink" href="/zh/community">社区</a>
            <ul class="collapse ">
                <li>
                    <a class="navlink" href="/zh/community/releases">发行版本</a>
                </li>
                <li >
                    <a class="navlink" href="/zh/community/roadmap">社区规划</a>
                </li>
            </ul>
        </li>
        <li id="contribute">
            <a class="navlink" href="/zh/contribute">贡献</a>
        </li>
        <li id="blog">
            <a class="navlink" href="/zh/blog">博客</a>
        </li>
        <li style="padding-top: 10px; border-top: 2px solid #448a78;">
            <a class="navlink resource" href="https://github.com/open-cluster-management-io" target="_blank"><i class="bi bi-github"></i><span style="padding-left: 10px;">GitHub</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://kubernetes.slack.com/channels/open-cluster-mgmt" target="_blank"><i class="bi bi-slack"></i><span style="padding-left: 10px;">Slack</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://www.youtube.com/c/OpenClusterManagement" target="_blank"><i class="bi bi-youtube"></i><span style="padding-left: 10px;">YouTube</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://groups.google.com/g/open-cluster-management" target="_blank"><i class="bi bi-envelope-fill"></i><span style="padding-left: 10px;">Mailing group</span></a>
        </li>
        <li>
            <a class="navlink resource" href="https://calendar.google.com/calendar/u/0/embed?src=openclustermanagement@gmail.com" target="_blank"><i class="bi bi-calendar-event-fill"></i><span style="padding-left: 10px;">Community meetings</span></a>
        </li>
    </ul>
</nav>
<script type="text/javascript" src="/sidebar.js"></script>
</div>
            <div class="col-lg-10 col-md-9 padding-none">
<div id="content">
    <h1>详解OCM add-on插件</h1>
    <p>2023年5月24日 <a href="https://github.com/zhiweiyin318">殷智伟</a></p>



  <div class="gdoc-toc gdoc-toc__level--6"><nav id="TableOfContents"><ul>
        <li><a href="#ocm-add-on插件概述">OCM add-on插件概述</a></li>
        <li><a href="#ocm-add-on-插件实现机制">OCM add-on 插件实现机制</a></li>
        <li><a href="#例子">例子</a></li>
        <li><a href="#ocm-add-on最新的改进和计划">OCM add-on最新的改进和计划</a></li>
      </ul></nav><hr></div>


<h2 id="ocm-add-on插件概述">OCM add-on插件概述</h2>
<p>OCM （open-cluster-management）是一个专注于Kubernetes应用跨多集群和多云的管理平台，
提供了集群的注册，应用和负载的分发，调度等基础功能。Add-on插件是OCM提供的一种基于基础组建
的扩展机制，可以让Kubernetes生态的应用很容易迁移到OCM平台上，拥有跨多集群多云的编排和调度的能力。</p>
<p>在OCM平台上，add-on插件可以实现不同被管理集群（Spoke）上应用的不同的配置，也可以实现从控制面（Hub）
获取数据到Spoke集群上等功能。比如：你可以使用<a href="https://github.com/open-cluster-management-io/managed-serviceaccount">managed-serviceaccount</a>
add-on插件在Spoke集群上将指定的ServiceaCount信息返回给Hub集群，可以使用<a href="https://github.com/open-cluster-management-io/cluster-proxy">cluster-proxy</a>
add-on插件建立一个从spoke到hub的反向代理通道。</p>
<p>现阶段OCM社区已经有的一些add-on：</p>
<ul>
<li><a href="https://open-cluster-management.io/zh/getting-started/integration/app-lifecycle/">Application lifecycle management</a>
add-on插件提供了一套通过Subscriptions订阅channel，将github仓库，Helm release或者对象存储仓库的应用分发到指定Spoke集群上的机制。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/cluster-proxy/">Cluster proxy</a> add-on插件通过反向代理通道提供了Hub和Spoke集群之间L4网络连接。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/managed-serviceaccount/">Managed service account</a>
add-on插件可以让Hub集群管理员很容易管理Spoke集群上serviceaccount。</li>
<li><a href="https://open-cluster-management.io/getting-started/integration/policy-framework/">Policy framework</a> 和
<a href="https://open-cluster-management.io/getting-started/integration/policy-controllers/">Policy controllers</a>
add-on插件可以让Hub集群管理员很轻松为Spoke集群部署安全相关的policy策略。</li>
<li><a href="https://github.com/stolostron/submariner-addon">Submarine Addon</a> add-on插件可以让<a href="https://github.com/submariner-io/submariner">Submarine</a>
和OCM方便集成，为被管理集群提供跨集群的Pod和Service网络互相访问的能力。</li>
<li><a href="https://github.com/stolostron/multicluster-mesh-addon">Multicluster Mesh Addon</a> add-on插件为OCM被管理集群提供了跨集群Service Mesh服务。</li>
</ul>
<p>本文将详细介绍add-on插件的实现机制。</p>
<h2 id="ocm-add-on-插件实现机制">OCM add-on 插件实现机制</h2>
<p>通常情况下一个add-on插件包含2部分组成：</p>
<ol>
<li><code>Add-on Agent</code> 是运行在Spoke集群上的任何Kubernetes资源，比如可以是一个有访问Hub权限的Pod，可以是一个Operator，等等。</li>
<li><code>Add-on Manager</code> 是运行中Hub集群上的一个Kubernetes控制器。这个控制器可以通过<a href="https://open-cluster-management.io/concepts/manifestwork/">ManifestWork</a>
来给不同Spoke集群部署分发<code>Add-on Agent</code>所需要的Kubernetes资源, 也可以管理<code>Add-on Agent</code>所需要的权限等。</li>
</ol>
<p>在OCM Hub集群上，关于add-on插件有2个主要的API：</p>
<ol>
<li><code>ClusterManagementAddOn</code>: 这是一个cluster-scoped的API，每个add-on插件必须创建一个同名的实例用来描述add-on插件的名字
和描述信息，以及配置，安装部署策略等。</li>
<li><code>ManagedClusterAddOn</code>: 这是一个namespace-scoped的API，部署到spoke集群的namespace下的和add-on同名的实例用来触发
<code>Add-on Agent</code>安装部署到该Spoke集群。我们也可以通过这个API获取这个add-on插件的agent的健康状态信息。</li>
</ol>
<p>Add-on 插件架构如下：</p>
<div style="text-align: center; padding: 20px;">
   <img src="./assets/addon-architecture.png" alt="Addon Architecture" style="margin: 0 auto; width: 80%">
</div>
<p>创建：</p>
<p><code>Add-on Manager</code> 监控<code>managedClusterAddOn</code> 来创建<code>manifestWork</code>把<code>Add-on Agent</code>部署到Spoke集群上，也可以根据
配置的部署策略只将agent部署到策略选中的集群上。</p>
<p>注册：</p>
<p>如果<code>Add-on Agent</code> 需要访问Hub集群，<code>registration-agent</code>会根据<code>managedClusterAddOn</code> 中的注册信息来向Hub集群
发起CSR请求来申请访问Hub集群的权限，<code>Add-on Manager</code> 根据自定义的approve策略来检查CSR请求，approve后，创建对应的RBAC
权限给agent，<code>registration-agent</code> 会生成一个含有指定权限的kubeconfig secret， agent可以通过这个secret来访问Hub集群。</p>
<p>原生Kubernetes CSR只支持<code>kubernetes.io/kube-apiserver-client</code>,<code>kubernetes.io/kube-apiserver-client-kubelet</code>
和<code>kubernetes.io/kubelet-serving</code> 这几种签名者（signer），我们可以提供让用户自定义证书和签名者来访问非kube-apiserver的服务，
在<code>Add-on Manager</code>上可以自定义验证签名者和证书是否正确来完成add-on的注册。</p>
<p>健康检查：</p>
<p><code>Add-on Agent</code>可以通过<code>addon-framework</code>提供的lease功能在Spoke集群上维护一个lease，<code>registration-agent</code> 监控这个Lease，
并通过Lease状态判断Agent是否健康，并更新到Hub集群的<code>managedClusterAddOn</code>的<code>Available</code>状态中。用户也可以通过其他自定义方式
来进行agent的健康检查，比如通过Add-on ManifestWork中某个资源的字段来判断agent是否健康。</p>
<p>开发：</p>
<p>OCM 社区提供了一个<a href="https://github.com/open-cluster-management-io/addon-framework">addon-framework</a>的库，
可以方便开发者快速开发自己的add-on插件Manager，也可以将自己的Kubernetnes 应用通过addon-framework便捷的以add-on插件的
形式迁移到OCM多集群上。</p>
<p>开发者将自己的Agent侧要部署的资源以Helm Chart或者Go Template的形式直接拷贝到工程目录，通过调用<a href="https://github.com/open-cluster-management-io/addon-framework/blob/main/pkg/addonfactory/addonfactory.go">addonfactory</a>就可以完成整个add-on注册，配置，健康检查等所有功能。详细请
参考<a href="https://open-cluster-management.io/developer-guides/addon/">add-on 开发指引</a>.</p>
<h2 id="例子">例子</h2>
<p>我们以<code>addon-framework</code>中的<a href="https://github.com/open-cluster-management-io/addon-framework/tree/main/examples">helloworldhelm</a>
add-on插件来举例。 这个add-on插件例子是将Hub集群上集群namespace下的configmap同步到Spoke集群上。</p>
<p>首先我们用KinD创建2个集群，一个当Hub集群安装OCM，并将另一个作为Spoke集群，以cluster1的名字注册到Hub集群。
可以参考<a href="https://open-cluster-management.io/zh//getting-started/">OCM安装</a>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get mcl
NAME       HUB ACCEPTED   MANAGED CLUSTER URLS   JOINED   AVAILABLE   AGE
cluster1   true           https://localhost      True     True        17s
</code></pre></div><p>然后在Hub集群上安装<code>helloworldhelm</code> add-on插件的<code>Add-on Manager</code>控制器。 具体步骤参考<a href="https://github.com/open-cluster-management-io/addon-framework/tree/main/examples">部署helloworldhelm add-on</a>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get deployments.apps -n open-cluster-management helloworld-controller
NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
helloworldhelm-controller   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           50s
</code></pre></div><p>在Hub集群上我们可以看到<code>helloworldhelm</code> add-on插件的<code>ClusterManagementAddOn</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get clustermanagementaddons.addon.open-cluster-management.io helloworldhelm -o yaml
apiVersion: addon.open-cluster-management.io/v1alpha1
kind: ClusterManagementAddOn
metadata:
  creationTimestamp: <span style="color:#e6db74">&#34;2023-05-28T14:12:32Z&#34;</span>
  generation: <span style="color:#ae81ff">1</span>
  name: helloworldhelm
  resourceVersion: <span style="color:#e6db74">&#34;457615&#34;</span>
  uid: 29ac6292-7346-4bc9-8013-fd90f40589d6
spec:
  addOnMeta:
    description: helloworldhelm is an example addon created by helm chart
    displayName: helloworldhelm
  installStrategy:
    type: Manual
  supportedConfigs:
  - group: addon.open-cluster-management.io
    resource: addondeploymentconfigs
  - group: <span style="color:#e6db74">&#34;&#34;</span>
    resource: configmaps
</code></pre></div><p>给cluster1 集群上部署<code>helloworldhelm</code> add-on, agent部署到Spoke集群的<code>open-cluster-management-agent-addon</code> namespace。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ clusteradm addon enable --names helloworldhelm --namespace open-cluster-management-agent-addon --clusters cluster1
</code></pre></div><p>我们看到Hub集群上cluster1的namespace下部署了一个<code>managedClusterAddon</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get managedclusteraddons.addon.open-cluster-management.io -n cluster1 helloworldhelm -o yaml
apiVersion: addon.open-cluster-management.io/v1alpha1
kind: ManagedClusterAddOn
metadata:
  creationTimestamp: <span style="color:#e6db74">&#34;2023-05-28T14:13:56Z&#34;</span>
  finalizers:
  - addon.open-cluster-management.io/addon-pre-delete
  generation: <span style="color:#ae81ff">1</span>
  name: helloworldhelm
  namespace: cluster1
  ownerReferences:
  - apiVersion: addon.open-cluster-management.io/v1alpha1
    blockOwnerDeletion: true
    controller: true
    kind: ClusterManagementAddOn
    name: helloworldhelm
    uid: 29ac6292-7346-4bc9-8013-fd90f40589d6
  resourceVersion: <span style="color:#e6db74">&#34;458003&#34;</span>
  uid: 84ceac57-3a7d-442f-bc28-d9828023d880
spec:
  installNamespace: open-cluster-management-agent-addon
status:
  conditions:
  - lastTransitionTime: <span style="color:#e6db74">&#34;2023-05-28T14:13:57Z&#34;</span>
    message: Registration of the addon agent is configured
    reason: SetPermissionApplied
    status: <span style="color:#e6db74">&#34;True&#34;</span>
    type: RegistrationApplied
  - lastTransitionTime: <span style="color:#e6db74">&#34;2023-05-28T14:13:57Z&#34;</span>
    message: manifests of addon are applied successfully
    reason: AddonManifestApplied
    status: <span style="color:#e6db74">&#34;True&#34;</span>
    type: ManifestApplied
  - lastTransitionTime: <span style="color:#e6db74">&#34;2023-05-28T14:13:57Z&#34;</span>
    message: client certificate rotated starting from 2023-05-28 14:08:57 +0000 UTC
      to 2024-05-27 14:08:57 +0000 UTC
    reason: ClientCertificateUpdated
    status: <span style="color:#e6db74">&#34;True&#34;</span>
    type: ClusterCertificateRotated
  - lastTransitionTime: <span style="color:#e6db74">&#34;2023-05-28T14:15:04Z&#34;</span>
    message: helloworldhelm add-on is available.
    reason: ManagedClusterAddOnLeaseUpdated
    status: <span style="color:#e6db74">&#34;True&#34;</span>
    type: Available
  namespace: open-cluster-management-agent-addon
  registrations:
  - signerName: kubernetes.io/kube-apiserver-client
    subject:
      groups:
      - system:open-cluster-management:cluster:cluster1:addon:helloworldhelm
      - system:open-cluster-management:addon:helloworldhelm
      - system:authenticated
      user: system:open-cluster-management:cluster:cluster1:addon:helloworldhelm:agent:8xz2x
  supportedConfigs:
  - group: <span style="color:#e6db74">&#34;&#34;</span>
    resource: configmaps
  - group: addon.open-cluster-management.io
    resource: addondeploymentconfigs
</code></pre></div><p>在Hub集群上的cluster1 namespace下，我们还可以看到部署add-on agent对应的<code>manifestWork</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get manifestwork -n cluster1
NAME                            AGE
addon-helloworldhelm-deploy-0   7m18s
</code></pre></div><p>在Spoke集群cluster1上，我们可以看到agent部署在了<code>open-cluster-management-agent-addon</code> namespace下,
agent通过绑定hub的kubeconfig来访问Hub同步configmap。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ kubectl get deployments.apps -n open-cluster-management-agent-addon
NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
helloworldhelm-agent   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           8m17s

$ kubectl get secret -n open-cluster-management-agent-addon
NAME                                  TYPE                                  DATA   AGE
helloworldhelm-hub-kubeconfig         Opaque                                <span style="color:#ae81ff">3</span>      8m17s
</code></pre></div><h2 id="ocm-add-on最新的改进和计划">OCM add-on最新的改进和计划</h2>
<p>在最新发布的OCM v0.11.0版本中，我们对add-on进行了很多功能的增强：</p>
<ol>
<li>在Hub集群上有专门的<a href="https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/12-addon-manager">addon-manager</a>
组建来管理add-on插件的配置和生命周期。</li>
<li>特别增强了<a href="https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/81-addon-lifecycle">add-on生命周期的管理</a>，升级了<code>ClusterManagementAddon</code> 和 <code>ManagedClusterAddOn</code>这两个API，
用户可以通过和<a href="https://github.com/open-cluster-management-io/placement">Placement</a>结合对指定集群上的add-on进行滚动升级和金丝雀升级。</li>
<li>我们还在设计一种新的add-on API <a href="https://github.com/open-cluster-management-io/enhancements/tree/main/enhancements/sig-architecture/82-addon-template">AddonTemplate</a> 来让用户不用进行代码开发就可以轻松实现自己的add-on插件的部署安装。</li>
</ol>

</div>
<script type="text/javascript" src="/clipboard-copy.js"></script>
</div>
        </div>
        <div class="row"><nav class="ocm navbar navbar-expand-lg navbar-dark py-3">
  <div class="container-fluid flex-wrap flex-md-nowrap">
    <div class="text-light">&copy; 2023 Open Cluster Management Authors. The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage/" target="_blank" style="color: #f8f9fa;">Trademark Usage</a></div>
  </div>
</nav>
<script type="text/javascript" src="/lang.js"></script>
</div>
    </div>
</body>
</html>
